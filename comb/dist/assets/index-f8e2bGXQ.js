(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))l(e);new MutationObserver(e=>{for(const r of e)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&l(c)}).observe(document,{childList:!0,subtree:!0});function o(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerPolicy&&(r.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?r.credentials="include":e.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function l(e){if(e.ep)return;e.ep=!0;const r=o(e);fetch(e.href,r)}})();const v={II:{id:"II",nameZh:"相同球 相同盒",nameEn:"Identical Balls, Identical Boxes",calculate:(t,n)=>{const o=Array.from({length:t+1},()=>Array(n+1).fill(0));for(let l=0;l<=n;l++)o[0][l]=1;for(let l=1;l<=t;l++)for(let e=1;e<=n;e++)o[l][e]=o[l][e-1],l>=e&&(o[l][e]+=o[l-e][e]);return o},formulaZh:`递推 1：f(n, m) = f(n, m-1) + f(n-m, m)
递推 2：f(n, m) = Σ_{k=1}^m f(n-k, k)`,formulaEn:`Recurrence 1: f(n, m) = f(n, m-1) + f(n-m, m)
Recurrence 2: f(n, m) = Σ_{k=1}^m f(n-k, k)`,closedZh:"组合意义：n 的 m 分拆 (Integer Partitions)",closedEn:"Note: Partitions of n into at most m parts",explainZh:"相同球相同盒。讨论如何分类：如果至少有一个空盒，即 f(n, m-1)；如果每个盒子都有球，先各放一个，剩下 n-m 个球放进 m 个盒子，即 f(n-m, m)。另一种方式是按非空盒子数 k 累加，在矩阵中表现为斜线。",explainEn:"Identical balls, Identical boxes. Two views: 1. At least one empty box f(n, m-1) vs. all boxes have balls f(n-m, m). 2. Summing over exactly k non-empty boxes, which forms a diagonal in the matrix.",getDependencies:(t,n,o=!1)=>{if(o){const l=[];for(let e=1;e<=n;e++)t-e>=0&&l.push({r:t-e,c:e,cls:"cell-source-group",label:`k=${e}`});return l}else return[{r:t,c:n-1,cls:"cell-source-1",label:"空盒"},{r:t-n,c:n,cls:"cell-source-2",label:"全满"}]}},DI:{id:"DI",nameZh:"不同球 相同盒",nameEn:"Distinct Balls, Identical Boxes",calculate:(t,n)=>{const o=Array.from({length:t+1},()=>Array(n+1).fill(0));o[0][0]=1;for(let e=1;e<=t;e++)for(let r=1;r<=n;r++)o[e][r]=r*o[e-1][r]+o[e-1][r-1];const l=Array.from({length:t+1},()=>Array(n+1).fill(0));for(let e=0;e<=t;e++)for(let r=1;r<=n;r++){let c=0;for(let m=1;m<=r;m++)c+=o[e][m];l[e][r]=e===0?1:c}return{matrix:o,totalMatrix:l,isStirling:!0}},formulaZh:`递推 1：S(n, m) = m·S(n-1, m) + S(n-1, m-1)
公式 2：f(n, m) = Σ_{k=1}^m S(n, k)`,formulaEn:`Recurrence 1: S(n, m) = m·S(n-1, m) + S(n-1, m-1)
Formula 2: f(n, m) = Σ_{k=1}^m S(n, k)`,closedZh:"总数：Σ S(n, k) (将 n 个不同球放入不超过 m 个相同盒子)",closedEn:"Total: Σ S(n, k) (n distinct balls into at most m identical boxes)",explainZh:"不同球相同盒。S(n, m) 是第二类斯特林数。逻辑：新球可以放进已有的 m 个盒子里 (m*S(n-1, m))，也可以单独占一个新盒子 (S(n-1, m-1))。总数是放入 1 到 m 个盒子的方法和。",explainEn:"Distinct balls into identical boxes. S(n, m) is Stirling Number II. Logic: New ball enters one of m existing boxes, or creates a new box. The total f(n, m) is the sum of S(n, k) for k=1 to m.",getDependencies:(t,n,o=!1)=>{if(o){const l=[];for(let e=1;e<=n;e++)l.push({r:t,c:e,cls:"cell-source-group",label:`k=${e}`,useStirling:!0});return l}else return[{r:t-1,c:n,cls:"cell-source-1",label:"m×"},{r:t-1,c:n-1,cls:"cell-source-2"}]}},ID:{id:"ID",nameZh:"相同球 不同盒",nameEn:"Identical Balls, Distinct Boxes",calculate:(t,n)=>{const l=Array.from({length:21},()=>Array(21).fill(0));for(let r=0;r<=20;r++){l[r][0]=1;for(let c=1;c<=r;c++)l[r][c]=l[r-1][c-1]+l[r-1][c]}const e=Array.from({length:t+1},()=>Array(n+1).fill(0));for(let r=0;r<=t;r++)for(let c=1;c<=n;c++)e[r][c]=l[r+c-1][c-1];return e},formulaZh:`递推 1：f(n, m) = f(n, m-1) + f(n-1, m)
递推 2：f(n, m) = Σ_{k=0}^n f(k, m-1)`,formulaEn:`Recurrence 1: f(n, m) = f(n, m-1) + f(n-1, m)
Recurrence 2: f(n, m) = Σ_{k=0}^n f(k, m-1)`,closedZh:"组合意义：n 个球放入 m 个盒子 (隔板法 C(n+m-1, m-1))",closedEn:"Note: Identical balls into distinct boxes (Stars and Bars)",explainZh:"相同球不同盒。可以按最后一个盒子的球数分类：放 0 个球，1 个球... 到 n 个球。即 f(n, m) 等于前 m-1 个盒子放不同数量球的方法数之和。",explainEn:"Identical balls into distinct boxes. Classify by the last box: it can have 0 to n balls. Thus f(n, m) is the sum of ways to put k balls into m-1 boxes.",getDependencies:(t,n,o=!1)=>{if(o){const l=[];for(let e=0;e<=t;e++)l.push({r:e,c:n-1,cls:"cell-source-group",label:`k=${e}`});return l}else return[{r:t,c:n-1,cls:"cell-source-1",label:"0球"},{r:t-1,c:n,cls:"cell-source-2",label:"≥1球"}]}},DD:{id:"DD",nameZh:"不同球 不同盒",nameEn:"Distinct Balls, Distinct Boxes",calculate:(t,n)=>{const o=Array.from({length:t+1},()=>Array(n+1).fill(0));for(let l=0;l<=n;l++)o[0][l]=1;for(let l=1;l<=t;l++)for(let e=0;e<=n;e++)o[l][e]=Math.pow(e,l);return o},formulaZh:"递推式：f(n, m) = m · f(n-1, m)",formulaEn:"Recurrence: f(n, m) = m · f(n-1, m)",closedZh:"通项公式：m^n (每个球有 m 种选择)",closedEn:"General Form: m^n (Each ball has m choices)",explainZh:"不同球不同盒。假设已经放好了 n-1 个球，对于第 n 个球，依然有 m 种盒子可以选。所以 f(n, m) = m * f(n-1, m)。总数即 m^n。",explainEn:"Distinct balls into distinct boxes. Suppose n-1 balls are placed. The n-th ball still has m choices. Thus f(n, m) = m * f(n-1, m). Total is m^n.",getDependencies:(t,n)=>[{r:t-1,c:n,cls:"cell-source-1",label:"m×"}]}};let u="II",i=5,a=3,d=!1,y=[];const C=document.getElementById("n-input"),w=document.getElementById("m-input"),M=document.getElementById("n-val"),T=document.getElementById("m-val"),$=document.getElementById("matrix-container"),A=document.querySelectorAll(".mode-btn"),N=document.querySelector(".formula-card"),f=document.getElementById("canvas"),s=f.getContext("2d"),O=document.querySelector(".visual-card");function j(){P(),I(),g()}function P(){C.addEventListener("input",t=>{i=parseInt(t.target.value),M.textContent=i,I(),g()}),w.addEventListener("input",t=>{a=parseInt(t.target.value),T.textContent=a,I(),g()}),A.forEach(t=>{t.addEventListener("click",()=>{A.forEach(n=>n.classList.remove("active")),t.classList.add("active"),u=t.dataset.mode,d=!1,g()})}),N.addEventListener("click",t=>{v[u].formulaZh.includes(`
`)&&(d=!d,g())}),O.addEventListener("click",()=>{I(),S()}),window.addEventListener("resize",()=>L()),L()}function L(){const t=f.parentElement;f.width=t.clientWidth,f.height=t.clientHeight,S()}function g(){const t=v[u];document.getElementById("explanation-zh").textContent=t.explainZh,document.getElementById("explanation-en").textContent=t.explainEn;const n=document.getElementById("recurrence-formula");if(n.innerHTML=t.formulaZh.replace(`
`,"<br>"),t.formulaZh.includes(`
`)){n.style.cursor="pointer",n.title="点击切换递推演示 / Click to toggle recurrence demo";const o=t.formulaZh.split(`
`);n.innerHTML=`<div class="${d?"":"active-formula"}">${o[0]}</div>
                        <div class="${d?"active-formula":""}">${o[1]}</div>`}else n.style.cursor="default",n.title="";document.getElementById("closed-formula").textContent=t.closedZh,R(),S()}function R(){const t=v[u],n=t.calculate(10,10),o=n.matrix||n;let l="<table><thead><tr><th>n\\m</th>";for(let e=0;e<=10;e++)l+=`<th>${e}</th>`;l+="</tr></thead><tbody>";for(let e=0;e<=10;e++){l+=`<tr><th>${e}</th>`;for(let r=0;r<=10;r++){let c=o[e][r];const m=e===i&&r===a;m&&u==="DI"&&d&&(c=n.totalMatrix[e][r]);let h=m?"cell-active":"",b="";const p=t.getDependencies(i,a,d).find(x=>x.r===e&&x.c===r);p&&!m&&(h=p.cls,p.label&&(b=`<span class="cell-label">${p.label}</span>`)),l+=`<td class="${h}" data-r="${e}" data-c="${r}">${b}${c}</td>`}l+="</tr>"}l+="</tbody></table>",$.innerHTML=l,$.querySelectorAll("td").forEach(e=>{e.addEventListener("click",()=>{i=parseInt(e.dataset.r),a=parseInt(e.dataset.c),C.value=i,w.value=a,M.textContent=i,T.textContent=a,g()})})}function I(){if(y=Array.from({length:a},()=>[]),u.startsWith("D"))for(let t=0;t<i;t++){const n=Math.floor(Math.random()*a);y[n].push(t)}else{let t=i;for(let n=0;n<a-1;n++){const o=Math.floor(Math.random()*(t+1));for(let l=0;l<o;l++)y[n].push("ball");t-=o}for(let n=0;n<t;n++)y[a-1].push("ball")}u.endsWith("I")&&y.sort((t,n)=>n.length-t.length)}function S(){s.clearRect(0,0,f.width,f.height);const t=50,n=80,o=60,l=(f.width-2*t-a*n)/(a-1||1);s.fillStyle="#fff",s.font="bold 16px Outfit",s.textAlign="center";const e=v[u].calculate(10,10),r=e.matrix||e;s.fillText(`${i} Balls → ${a} Boxes: ${r[i][a]} ways`,f.width/2,30),s.font="12px Outfit",s.fillStyle=E("--text-secondary"),s.fillText("(点击卡片切换示例 / Click card to cycle examples)",f.width/2,50);for(let c=0;c<a;c++){const m=t+c*(n+l),h=f.height-120;s.strokeStyle=E("--accent-color"),s.lineWidth=2,s.strokeRect(m,h,n,o),s.fillStyle=E("--text-secondary"),s.font="12px Outfit",s.textAlign="center";const b=u.endsWith("D")?`Box ${c+1}`:`Part ${c+1}`;s.fillText(b,m+n/2,h+o+20);const k=y[c],p=6;k.forEach((x,D)=>{const B=m+15+D%4*15,Z=h+15+Math.floor(D/4)*15;s.beginPath(),s.arc(B,Z,p,0,Math.PI*2),typeof x=="number"?(s.fillStyle=`hsl(${x*360/i}, 70%, 60%)`,s.fill(),s.fillStyle="#fff",s.font="8px Outfit",s.fillText(x+1,B,Z+3)):(s.fillStyle=E("--text-secondary"),s.fill())})}}function E(t){return getComputedStyle(document.documentElement).getPropertyValue(t).trim()}j();
